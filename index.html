<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Penguin Paradise | Real AI Assistant</title>
  <meta name="description" content="Discover penguins with a real AI assistant. Login to save chats and unlock premium features.">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <style>
    :root {
      --primary: #0d4a6b;
      --secondary: #2e7d32;
      --accent: #d32f2f;
      --bg: #e3f2fd;
      --card: #ffffff;
      --text: #1a237e;
      --gold: #ffd700;
      --footer-bg: #0a2e4d;
      --modal-bg: rgba(0,0,0,0.85);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', system-ui, sans-serif; }
    body { background: var(--bg); color: var(--text); line-height: 1.6; }
    .container { width: 90%; max-width: 1200px; margin: 0 auto; padding: 0 15px; }

    /* Auth Modal */
    .auth-modal {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: var(--modal-bg);
      z-index: 2000;
      justify-content: center;
      align-items: center;
    }
    .auth-content {
      background: white; padding: 2.5rem; border-radius: 16px; width: 90%; max-width: 450px;
    }
    .auth-content h2 { text-align: center; margin-bottom: 1.5rem; color: var(--primary); }
    .form-group { margin-bottom: 1.2rem; }
    .form-group label { display: block; margin-bottom: 6px; font-weight: 600; }
    .form-control {
      width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem;
    }
    .btn { padding: 10px 20px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; }
    .btn-block { width: 100%; margin-top: 10px; }
    .btn-primary { background: #4fc3f7; color: var(--footer-bg); }
    .btn-outline { background: transparent; border: 1px solid white; color: white; }
    .switch-form { text-align: center; margin-top: 15px; color: #666; }
    .switch-form a { color: var(--secondary); text-decoration: none; font-weight: 600; }

    /* Rest of styles (condensed for brevity - same as before) */
    header { background: var(--footer-bg); color: white; padding: 1rem 0; }
    .header-content { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
    .logo { font-size: 1.8rem; display: flex; align-items: center; gap: 10px; }
    .auth-buttons { display: flex; gap: 10px; }
    main { padding: 2rem 0; }
    .hero { 
      background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://images.unsplash.com/photo-1543507480-47292485e591?auto=format&fit=crop&w=1200&q=80');
      height: 400px; border-radius: 16px; margin-bottom: 2.5rem; display: flex; align-items: center; justify-content: center; color: white; 
    }
    .hero-content { text-align: center; max-width: 800px; }
    .features { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 2rem; margin: 2.5rem 0; }
    .feature-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    .feature-icon { height: 180px; background: var(--secondary); display: flex; align-items: center; justify-content: center; color: white; font-size: 3rem; }
    .feature-content { padding: 1.5rem; }
    .upgrade-banner { 
      background: linear-gradient(135deg, #ffeaa7, #fdcb6e); 
      padding: 2rem; border-radius: 12px; text-align: center; margin: 2rem 0; display: none; 
    }
    .chat-container { display: none; background: white; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.15); margin: 2rem 0; }
    .chat-header { background: var(--primary); color: white; padding: 1rem 1.5rem; display: flex; justify-content: space-between; align-items: center; }
    .chat-messages { height: 400px; padding: 1.5rem; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; }
    .message { max-width: 80%; padding: 12px 16px; border-radius: 18px; line-height: 1.5; }
    .user-message { background: #e3f2fd; align-self: flex-end; }
    .bot-message { background: #e8f5e9; align-self: flex-start; }
    .chat-input { display: flex; padding: 0 1.5rem 1.5rem; gap: 10px; }
    .chat-input input { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 30px; }
    .chat-input button { background: var(--secondary); color: white; border: none; padding: 12px 24px; border-radius: 30px; }
    .admin-panel { display: none; background: #f0f9ff; border: 2px dashed #4fc3f7; border-radius: 12px; padding: 2rem; margin: 2rem 0; }
    footer { background: var(--footer-bg); color: #cfd8dc; padding: 2.5rem 0 1.5rem; margin-top: 3rem; }
    .footer-bottom { text-align: center; padding-top: 1.5rem; border-top: 1px solid #37474f; }
    .premium-badge { color: var(--gold); font-weight: bold; }
    .loading { text-align: center; padding: 2rem; display: none; }
    .spinner { border: 4px solid rgba(0,0,0,0.1); border-left: 4px solid var(--secondary); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 15px; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    /* Secret Code Modal */
    .credits-modal {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: var(--modal-bg);
      z-index: 2000;
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: white; padding: 2.5rem; border-radius: 16px; width: 90%; max-width: 500px; text-align: center;
    }
    .modal-input {
      width: 100%; padding: 14px; margin: 20px 0; border: 1px solid #ddd; border-radius: 8px; font-size: 1.1rem; text-align: center;
    }
  </style>
</head>
<body>
  <!-- Auth Modals -->
  <div id="loginModal" class="auth-modal">
    <div class="auth-content">
      <h2>Login to Penguin Paradise</h2>
      <div class="form-group">
        <label for="loginEmail">Email</label>
        <input type="email" id="loginEmail" class="form-control" placeholder="you@example.com">
      </div>
      <div class="form-group">
        <label for="loginPassword">Password</label>
        <input type="password" id="loginPassword" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
      </div>
      <button id="doLogin" class="btn btn-primary btn-block">Login</button>
      <div class="switch-form">
        Don't have an account? <a href="#" id="showSignup">Sign Up</a>
      </div>
    </div>
  </div>

  <div id="signupModal" class="auth-modal">
    <div class="auth-content">
      <h2>Create an Account</h2>
      <div class="form-group">
        <label for="signupEmail">Email</label>
        <input type="email" id="signupEmail" class="form-control" placeholder="you@example.com">
      </div>
      <div class="form-group">
        <label for="signupPassword">Password</label>
        <input type="password" id="signupPassword" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
      </div>
      <button id="doSignup" class="btn btn-primary btn-block">Sign Up</button>
      <div class="switch-form">
        Already have an account? <a href="#" id="showLogin">Login</a>
      </div>
    </div>
  </div>

  <!-- Secret Code Modal -->
  <div id="creditsModal" class="credits-modal">
    <div class="modal-content">
      <h2>Enter Secret Code</h2>
      <p>Access the AI Penguin Assistant by entering the secret code:</p>
      <input type="text" id="secretCode" class="modal-input" placeholder="K120472" maxlength="8" autocomplete="off">
      <button id="submitCode" class="btn btn-primary">Unlock</button>
      <button id="closeModal" class="btn btn-outline" style="margin-top:15px; background:transparent; border-color:white;">Close</button>
    </div>
  </div>

  <!-- Main Site -->
  <header>
    <div class="container">
      <div class="header-content">
        <div class="logo"><i class="fas fa-igloo"></i> Penguin Paradise</div>
        <div class="auth-buttons">
          <button id="loginBtn" class="btn btn-outline">Login</button>
          <button id="signupBtn" class="btn btn-primary">Sign Up</button>
          <div id="userProfile" style="display:none; align-items:center; gap:10px;">
            <span id="userName"></span>
            <button id="logoutBtn" class="btn btn-outline">Logout</button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="hero">
      <div class="hero-content">
        <h1>Discover Penguins with AI</h1>
        <p>Real-time facts from a penguin-specialized AI assistant. Login to save your chats!</p>
      </div>
    </div>

    <div class="features">
      <div class="feature-card">
        <div class="feature-icon"><i class="fas fa-robot"></i></div>
        <div class="feature-content">
          <h3>AI-Powered Facts</h3>
          <p>Ask anything about penguin species, habitats, or conservation.</p>
        </div>
      </div>
      <div class="feature-card">
        <div class="feature-icon"><i class="fas fa-save"></i></div>
        <div class="feature-content">
          <h3>Save Your Chats</h3>
          <p>Logged-in users can save conversations for later reference.</p>
        </div>
      </div>
      <div class="feature-card">
        <div class="feature-icon"><i class="fas fa-crown"></i></div>
        <div class="feature-content">
          <h3>Premium Access</h3>
          <p>Unlock the most advanced AI model for deeper insights.</p>
        </div>
      </div>
    </div>

    <div id="upgradeBanner" class="upgrade-banner">
      <h2>‚ú® Upgrade to Premium for Better AI! ‚ú®</h2>
      <p>Access the most accurate penguin AI model with faster responses.</p>
      <button id="upgradeBtn" class="btn btn-primary">Request Upgrade</button>
    </div>

    <div id="chatContainer" class="chat-container">
      <div class="chat-header">
        <h3><i class="fas fa-robot"></i> Penguin AI Assistant</h3>
        <button id="saveChatBtn" class="btn btn-outline">Save Chat</button>
      </div>
      <div class="chat-messages" id="chatMessages">
        <div class="message bot-message">Hello! I'm your Penguin AI Assistant. Ask me anything about penguins! üêß</div>
      </div>
      <div class="chat-input">
        <input type="text" id="userInput" placeholder="e.g., What do emperor penguins eat?">
        <button id="sendBtn">Send</button>
      </div>
    </div>

    <div class="loading" id="loadingIndicator">
      <div class="spinner"></div>
      <p>Consulting the penguin AI...</p>
    </div>

    <div id="adminPanel" class="admin-panel">
      <h2>Admin Dashboard</h2>
      <p>Grant premium access to users:</p>
      <div id="userList">Loading users...</div>
    </div>
  </main>

  <footer>
    <div class="container">
      <div style="text-align: center; padding: 2rem 0;">
        <p>¬© 2025 Penguin Paradise</p>
        <p><a href="#" id="creditsLink" style="color:#4fc3f7;">Credits</a></p>
      </div>
    </div>
  </footer>

  <script>
    // üîë CONFIGURATION - REPLACE THESE
    const ADMIN_EMAIL = "lkmukhil@gmail.com";
    const SECRET_CODE = "K120472";
    
    // üîë GET YOUR HUGGING FACE TOKEN AT: https://huggingface.co/settings/tokens
    const HUGGING_FACE_TOKEN = "${HUGGING_FACE_TOKEN}"; // ‚Üê REPLACE THIS
    
    // Firebase config - REPLACE WITH YOURS
    const firebaseConfig = {
  apiKey: "AIzaSyA-7KtFeFcUndaOxdYxjTAzTsaBKvuOdDA",
  authDomain: "nexus-2842a.firebaseapp.com",
  projectId: "nexus-2842a",
  storageBucket: "nexus-2842a.firebasestorage.app",
  messagingSenderId: "888654157334",
  appId: "1:888654157334:web:9178855888bff2aaeac737",
  measurementId: "G-9F4JH2NYR0"
};

    // AI Models
    const FREE_MODEL = "microsoft/DialoGPT-medium";       // 2nd best free
    const PREMIUM_MODEL = "facebook/blenderbot-400M-distill"; // 1st best free

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // DOM Elements
    const loginBtn = document.getElementById('loginBtn');
    const signupBtn = document.getElementById('signupBtn');
    const loginModal = document.getElementById('loginModal');
    const signupModal = document.getElementById('signupModal');
    const doLogin = document.getElementById('doLogin');
    const doSignup = document.getElementById('doSignup');
    const showSignup = document.getElementById('showSignup');
    const showLogin = document.getElementById('showLogin');
    const logoutBtn = document.getElementById('logoutBtn');
    const userProfile = document.getElementById('userProfile');
    const userName = document.getElementById('userName');
    const creditsLink = document.getElementById('creditsLink');
    const creditsModal = document.getElementById('creditsModal');
    const secretCode = document.getElementById('secretCode');
    const submitCode = document.getElementById('submitCode');
    const closeModal = document.getElementById('closeModal');
    const chatContainer = document.getElementById('chatContainer');
    const chatMessages = document.getElementById('chatMessages');
    const userInput = document.getElementById('userInput');
    const sendBtn = document.getElementById('sendBtn');
    const saveChatBtn = document.getElementById('saveChatBtn');
    const upgradeBanner = document.getElementById('upgradeBanner');
    const upgradeBtn = document.getElementById('upgradeBtn');
    const adminPanel = document.getElementById('adminPanel');
    const userList = document.getElementById('userList');
    const loadingIndicator = document.getElementById('loadingIndicator');

    // State
    let currentUser = null;
    let isAdmin = false;
    let isPremium = false;
    let currentModel = FREE_MODEL;

    // Initialize
    function init() {
      // Auth state listener
      auth.onAuthStateChanged(user => {
        if (user) {
          currentUser = user;
          loginBtn.style.display = 'none';
          signupBtn.style.display = 'none';
          userProfile.style.display = 'flex';
          userName.textContent = user.email.split('@')[0];
          checkUserStatus();
        } else {
          resetUI();
        }
      });

      // Event Listeners
      loginBtn.addEventListener('click', () => loginModal.style.display = 'flex');
      signupBtn.addEventListener('click', () => signupModal.style.display = 'flex');
      showSignup.addEventListener('click', () => { loginModal.style.display = 'none'; signupModal.style.display = 'flex'; });
      showLogin.addEventListener('click', () => { signupModal.style.display = 'none'; loginModal.style.display = 'flex'; });
      doLogin.addEventListener('click', handleLogin);
      doSignup.addEventListener('click', handleSignup);
      logoutBtn.addEventListener('click', () => auth.signOut());
      creditsLink.addEventListener('click', () => creditsModal.style.display = 'flex');
      closeModal.addEventListener('click', () => { creditsModal.style.display = 'none'; secretCode.value = ''; });
      submitCode.addEventListener('click', handleSecretCode);
      sendBtn.addEventListener('click', sendMessage);
      userInput.addEventListener('keypress', e => e.key === 'Enter' && sendMessage());
      saveChatBtn.addEventListener('click', saveChat);
      upgradeBtn.addEventListener('click', requestUpgrade);

      // Close modals on outside click
      [loginModal, signupModal, creditsModal].forEach(modal => {
        modal.addEventListener('click', e => {
          if (e.target === modal) {
            modal.style.display = 'none';
            if (modal === creditsModal) secretCode.value = '';
          }
        });
      });
    }

    function resetUI() {
      currentUser = null;
      isAdmin = false;
      isPremium = false;
      loginBtn.style.display = 'block';
      signupBtn.style.display = 'block';
      userProfile.style.display = 'none';
      adminPanel.style.display = 'none';
      upgradeBanner.style.display = 'none';
      chatContainer.style.display = 'none';
    }

    async function checkUserStatus() {
      if (!currentUser) return;

      try {
        // Check if user is admin
        if (currentUser.email === ADMIN_EMAIL) {
          isAdmin = true;
          isPremium = true;
          adminPanel.style.display = 'block';
          loadUsersForAdmin();
        } else {
          // Check premium status from Firestore
          const userDoc = await db.collection('users').doc(currentUser.uid).get();
          if (userDoc.exists) {
            isPremium = userDoc.data().isPremium || false;
          } else {
            // Create user doc if not exists
            await db.collection('users').doc(currentUser.uid).set({
              email: currentUser.email,
              isPremium: false,
              createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            isPremium = false;
          }
        }

        // Set model
        currentModel = isPremium ? PREMIUM_MODEL : FREE_MODEL;

        // UI updates
        if (isPremium) {
          userName.innerHTML = `<span class="premium-badge"><i class="fas fa-crown"></i> ${userName.textContent}</span>`;
          upgradeBanner.style.display = 'none';
        } else {
          upgradeBanner.style.display = 'block';
        }
      } catch (err) {
        console.error("Error checking user status:", err);
        alert("Error loading user status. Please refresh.");
      }
    }

    // üîê Auth Functions
    async function handleLogin() {
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      if (!email || !password) {
        alert("Please fill in all fields");
        return;
      }

      try {
        await auth.signInWithEmailAndPassword(email, password);
        loginModal.style.display = 'none';
        document.getElementById('loginEmail').value = '';
        document.getElementById('loginPassword').value = '';
      } catch (err) {
        console.error("Login error:", err);
        alert("Login failed: " + err.message);
      }
    }

    async function handleSignup() {
      const email = document.getElementById('signupEmail').value;
      const password = document.getElementById('signupPassword').value;
      if (!email || !password || password.length < 6) {
        alert("Password must be at least 6 characters");
        return;
      }

      try {
        await auth.createUserWithEmailAndPassword(email, password);
        signupModal.style.display = 'none';
        document.getElementById('signupEmail').value = '';
        document.getElementById('signupPassword').value = '';
      } catch (err) {
        console.error("Signup error:", err);
        alert("Signup failed: " + err.message);
      }
    }

    // üîë Secret Code
    function handleSecretCode() {
      if (secretCode.value.trim() === SECRET_CODE) {
        creditsModal.style.display = 'none';
        secretCode.value = '';
        chatContainer.style.display = 'block';
        chatContainer.scrollIntoView({ behavior: 'smooth' });
      } else {
        alert("Incorrect code. Please try again.");
      }
    }

    // üí¨ AI Chat with Hugging Face
    async function sendMessage() {
      const message = userInput.value.trim();
      if (!message) return;

      addMessage(message, 'user');
      userInput.value = '';
      showLoading();

      try {
        const response = await queryHuggingFace(message, currentModel);
        addMessage(response, 'bot');
      } catch (err) {
        console.error("AI Error:", err);
        addMessage("Sorry, I'm having trouble connecting to the penguin AI. Please try again.", 'bot');
      } finally {
        hideLoading();
      }
    }

    async function queryHuggingFace(prompt, model) {
      if (!HUGGING_FACE_TOKEN) {
        throw new Error("Hugging Face token not configured");
      }

      // Format prompt for chat models
      const formattedPrompt = `User: ${prompt}\nBot:`;

      const response = await fetch(`https://api-inference.huggingface.co/models/${model}`, {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${HUGGING_FACE_TOKEN}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          inputs: formattedPrompt,
          parameters: {
            max_new_tokens: 100,
            temperature: 0.7,
            top_p: 0.9,
            return_full_text: false
          }
        })
      });

      if (!response.ok) {
        throw new Error(`Hugging Face API error: ${response.status} ${response.statusText}`);
      }

      const result = await response.json();
      let generatedText = "";

      if (Array.isArray(result)) {
        generatedText = result[0]?.generated_text || "";
      } else if (typeof result === "object" && result.generated_text) {
        generatedText = result.generated_text;
      } else {
        generatedText = JSON.stringify(result);
      }

      // Clean up response
      return generatedText
        .replace(/User:.+?Bot:/g, '') // Remove prompt repetition
        .replace(/^"(.*)"$/, '$1')     // Remove quotes
        .trim();
    }

    function addMessage(text, sender) {
      const div = document.createElement('div');
      div.className = `message ${sender}-message`;
      div.textContent = text;
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function showLoading() {
      loadingIndicator.style.display = 'block';
      sendBtn.disabled = true;
    }

    function hideLoading() {
      loadingIndicator.style.display = 'none';
      sendBtn.disabled = false;
    }

    // üíæ Save Chat to Firestore
    async function saveChat() {
      if (!currentUser) {
        alert("Please log in to save chats!");
        return;
      }

      const messages = Array.from(chatMessages.children).map(el => ({
        text: el.textContent,
        sender: el.classList.contains('user-message') ? 'user' : 'bot',
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      }));

      if (messages.length <= 1) {
        alert("No conversation to save!");
        return;
      }

      try {
        await db.collection('users').doc(currentUser.uid).collection('chats').add({
          messages: messages,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        alert("Chat saved successfully!");
      } catch (err) {
        console.error("Save error:", err);
        alert("Failed to save chat. Please try again.");
      }
    }

    // ‚≠ê Upgrade Request
    async function requestUpgrade() {
      if (!currentUser) {
        alert("Please log in first!");
        return;
      }

      try {
        await db.collection('premiumRequests').add({
          userId: currentUser.uid,
          userEmail: currentUser.email,
          timestamp: firebase.firestore.FieldValue.serverTimestamp(),
          status: 'pending'
        });
        alert("Upgrade request sent! The admin will review it soon.");
        upgradeBanner.style.display = 'none';
      } catch (err) {
        console.error("Upgrade error:", err);
        alert("Failed to send request. Please try again.");
      }
    }

    // üëë Admin Functions
    async function loadUsersForAdmin() {
      if (!isAdmin) return;

      try {
        const usersSnapshot = await db.collection('users').get();
        let html = '';
        usersSnapshot.forEach(doc => {
          const data = doc.data();
          html += `
            <div style="padding: 10px; border-bottom: 1px solid #eee;">
              <strong>${data.email}</strong> 
              ${data.isPremium ? '<span style="color:gold;">‚≠ê Premium</span>' : ''}
              <button onclick="grantPremium('${doc.id}')" style="margin-left:10px;" class="btn ${data.isPremium ? 'btn-outline' : 'btn-primary'}">
                ${data.isPremium ? 'Revoke' : 'Grant'} Premium
              </button>
            </div>
          `;
        });
        userList.innerHTML = html || "No users found.";
      } catch (err) {
        console.error("Admin load error:", err);
        userList.innerHTML = "Error loading users.";
      }
    }

    // Make grantPremium available globally for inline onclick
    window.grantPremium = async function(userId) {
      if (!isAdmin) return;

      try {
        const userRef = db.collection('users').doc(userId);
        const doc = await userRef.get();
        if (!doc.exists) return;

        const newStatus = !doc.data().isPremium;
        await userRef.update({ isPremium: newStatus });
        
        alert(`${newStatus ? 'Granted' : 'Revoked'} premium for user.`);
        loadUsersForAdmin();
        // If this is the current user, update UI
        if (currentUser && currentUser.uid === userId) {
          isPremium = newStatus;
          currentModel = isPremium ? PREMIUM_MODEL : FREE_MODEL;
          checkUserStatus();
        }
      } catch (err) {
        console.error("Grant error:", err);
        alert("Failed to update premium status.");
      }
    };

    // Start app
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
