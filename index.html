<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Penguin Paradise | Your Antarctic Companion</title>
  <meta name="description" content="Discover penguins, their habitats, species, and conservation. A beautiful resource for penguin lovers.">

  <!-- Firebase SDKs (CDN) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-yycv9QnZkS8DQqfK+1i7J9V5qZ8Xh8qX2q3Z1aZbY5d1dQb4Q1b1i1XQa3a8X5d1d3Z1aZbY5d1dQb4Q1b1i1XQa3a8X5d1d3Z1aZbY5d1dQb4Q1b1i1XQa3a8X5d1d3Z1aZbY5d1dQb4Q1b1i1XQa3a8X5d1d3Z1aZbY5d1dQb4Q1b1i1XQa3a8X5d1d3Z1aZbY5d1dQb4Q1b1i1XQa3a8X5d1d3Z1aZbY5d1dQb4Q1b1i1XQa3a8X5d1d3Z1aZbY5d1dQb4Q1b1i1XQa3a8X5d1d3Z1aZbY5d1dQb4Q1b1i1XQa3a8X5d1d3Z1aZbY5d1dQb4Q1b1i1XQa3a8X5d1d3Z1aZbY5d1dQb4Q1b1i1XQa3a8X5d1d3Z1aZbY5d1dQb4Q1b1i1XQa3a8X5d1d3Z1aZbY5d1dQb4Q1b1i1XQa3a8X5d1d3Z1aZbY5d1dQb4Q1b1i1XQa3a8X5d1d3Z1aZbY5d1dQb4Q1b1i1XQa3a8X5d1d3Z1aZbY5d1dQb4Q1b1i1XQa3a8X5d1d3Z1aZbY5d1dQb4Q1b1i1XQa3a8X5d1d3Z1aZbY5d1dQb4Q1b1i1XQa3a8X5d1d3......" crossorigin="anonymous" referrerpolicy="no-referrer" />
  
  <style>
    :root {
      --primary: #0d4a6b;
      --secondary: #2e7d32;
      --accent: #d32f2f;
      --bg: #e3f2fd;
      --card: #ffffff;
      --text: #1a237e;
      --gold: #ffd700;
      --footer-bg: #0a2e4d;
      --shadow: 0 4px 12px rgba(0,0,0,0.1);
      --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', sans-serif;
    }

    body {
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      scroll-behavior: smooth;
    }

    .container {
      width: 90%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 15px;
    }

    /* Header */
    header {
      background: var(--footer-bg);
      color: white;
      padding: 1rem 0;
      box-shadow: var(--shadow);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
    }

    .logo {
      font-size: 1.8rem;
      font-weight: 800;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo i {
      color: var(--gold);
    }

    nav ul {
      display: flex;
      list-style: none;
      gap: 1.5rem;
      flex-wrap: wrap;
      justify-content: center;
    }

    nav a {
      color: rgba(255,255,255,0.9);
      text-decoration: none;
      font-weight: 600;
      padding: 6px 12px;
      border-radius: 6px;
      transition: var(--transition);
    }

    nav a:hover {
      background: rgba(255,255,255,0.15);
      color: white;
    }

    .auth-section {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .btn {
      padding: 9px 18px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      font-size: 0.95rem;
    }

    .btn-outline {
      background: transparent;
      border: 1px solid white;
      color: white;
    }

    .btn-primary {
      background: #4fc3f7;
      color: var(--footer-bg);
    }

    .btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .premium-badge {
      color: var(--gold);
      font-weight: bold;
      text-shadow: 0 0 6px rgba(255,215,0,0.5);
      display: flex;
      align-items: center;
      gap: 5px;
    }

    /* Main Content */
    main {
      padding: 2.5rem 0;
    }

    .hero {
      background: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), url('https://images.unsplash.com/photo-1543507480-47292485e591?ixlib=rb-4.0.3&auto=format&fit=crop&w=1470&q=80');
      background-size: cover;
      background-position: center;
      height: 450px;
      border-radius: 18px;
      margin-bottom: 3rem;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      text-align: center;
    }

    .hero-content {
      max-width: 800px;
      padding: 0 20px;
    }

    .hero h1 {
      font-size: 3rem;
      margin-bottom: 1.2rem;
      text-shadow: 0 2px 4px rgba(0,0,0,0.7);
    }

    .hero p {
      font-size: 1.3rem;
      margin-bottom: 2rem;
      text-shadow: 0 1px 2px rgba(0,0,0,0.8);
    }

    /* Features */
    .section-title {
      text-align: center;
      margin: 2.5rem 0 1.8rem;
      color: var(--primary);
      font-size: 2rem;
      position: relative;
    }

    .section-title::after {
      content: '';
      display: block;
      width: 80px;
      height: 4px;
      background: var(--secondary);
      margin: 10px auto 0;
      border-radius: 2px;
    }

    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 2rem;
      margin-bottom: 3rem;
    }

    .feature-card {
      background: var(--card);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: var(--shadow);
      transition: var(--transition);
    }

    .feature-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .feature-icon {
      height: 180px;
      background: var(--secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 4rem;
    }

    .feature-content {
      padding: 1.8rem;
    }

    .feature-content h3 {
      margin-bottom: 0.8rem;
      color: var(--primary);
    }

    /* Gallery */
    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 20px;
      margin-top: 1.5rem;
    }

    .gallery-item {
      height: 220px;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: var(--shadow);
    }

    .gallery-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: var(--transition);
    }

    .gallery-item img:hover {
      transform: scale(1.05);
    }

    /* Upgrade Banner */
    .upgrade-banner {
      background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
      padding: 2.2rem;
      border-radius: 16px;
      text-align: center;
      margin: 2.5rem 0;
      display: none;
      border: 2px dashed #e17055;
    }

    .upgrade-banner h2 {
      color: var(--primary);
      margin-bottom: 1rem;
      font-size: 2rem;
    }

    .upgrade-btn {
      background: var(--primary);
      color: white;
      padding: 14px 36px;
      font-size: 1.2rem;
      border-radius: 50px;
      margin-top: 15px;
    }

    /* Chat UI */
    .chat-container {
      display: none;
      background: var(--card);
      border-radius: 18px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.15);
      margin: 2.5rem 0;
      overflow: hidden;
    }

    .chat-header {
      background: var(--primary);
      color: white;
      padding: 1.2rem 1.8rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .chat-messages {
      height: 420px;
      padding: 1.8rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .message {
      max-width: 85%;
      padding: 14px 20px;
      border-radius: 20px;
      line-height: 1.5;
      position: relative;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .user-message {
      background: #e3f2fd;
      align-self: flex-end;
      border-bottom-right-radius: 5px;
    }

    .bot-message {
      background: #e8f5e9;
      align-self: flex-start;
      border-bottom-left-radius: 5px;
    }

    .chat-input {
      display: flex;
      padding: 0 1.8rem 1.8rem;
      gap: 12px;
    }

    .chat-input input {
      flex: 1;
      padding: 14px 20px;
      border: 1px solid #ddd;
      border-radius: 50px;
      font-size: 1rem;
      outline: none;
    }

    .chat-input input:focus {
      border-color: var(--secondary);
      box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.2);
    }

    .chat-input button {
      background: var(--secondary);
      color: white;
      border: none;
      padding: 0 28px;
      border-radius: 50px;
      font-weight: bold;
      cursor: pointer;
    }

    /* Admin Panel */
    .admin-panel {
      display: none;
      background: #f0f7ff;
      border: 2px dashed #4fc3f7;
      border-radius: 16px;
      padding: 2.2rem;
      margin: 2.5rem 0;
    }

    .admin-panel h2 {
      text-align: center;
      color: var(--primary);
      margin-bottom: 1.8rem;
      font-size: 1.8rem;
    }

    .user-list {
      max-height: 350px;
      overflow-y: auto;
      background: white;
      border-radius: 12px;
      box-shadow: var(--shadow);
    }

    .user-item {
      display: flex;
      justify-content: space-between;
      padding: 16px 20px;
      border-bottom: 1px solid #eee;
    }

    .user-item:last-child {
      border-bottom: none;
    }

    .user-info span {
      display: block;
    }

    .user-info .email {
      font-size: 0.85rem;
      color: #666;
    }

    /* Footer */
    footer {
      background: var(--footer-bg);
      color: #bbdefb;
      padding: 3rem 0 2rem;
      margin-top: 3rem;
    }

    .footer-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 2.5rem;
      margin-bottom: 2rem;
    }

    .footer-section h3 {
      margin-bottom: 1.2rem;
      position: relative;
      padding-bottom: 0.5rem;
      color: white;
    }

    .footer-section h3::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 50px;
      height: 3px;
      background: #4fc3f7;
    }

    .footer-section ul {
      list-style: none;
    }

    .footer-section ul li {
      margin-bottom: 0.8rem;
    }

    .footer-section a {
      color: #90caf9;
      text-decoration: none;
      transition: var(--transition);
    }

    .footer-section a:hover {
      color: white;
      padding-left: 5px;
    }

    .footer-bottom {
      text-align: center;
      padding-top: 1.5rem;
      border-top: 1px solid #3949ab;
      color: #90a4ae;
    }

    /* Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.75);
      z-index: 2000;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: white;
      padding: 2.5rem;
      border-radius: 20px;
      width: 90%;
      max-width: 520px;
      text-align: center;
      box-shadow: 0 15px 50px rgba(0,0,0,0.4);
    }

    .modal-content h2 {
      margin-bottom: 1.2rem;
      color: var(--primary);
    }

    .modal-input {
      width: 100%;
      padding: 16px;
      margin: 20px 0;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      font-size: 1.2rem;
      text-align: center;
      letter-spacing: 2px;
    }

    .modal-input:focus {
      border-color: var(--secondary);
      outline: none;
      box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.2);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .hero h1 { font-size: 2.2rem; }
      .hero p { font-size: 1.1rem; }
      .header-content { flex-direction: column; text-align: center; }
      nav ul { justify-content: center; }
      .auth-section { justify-content: center; width: 100%; }
    }

    /* Loading */
    .loading {
      text-align: center;
      padding: 2rem;
      display: none;
    }

    .spinner {
      border: 4px solid rgba(0,0,0,0.1);
      border-left: 4px solid var(--secondary);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <div class="header-content">
        <div class="logo">
          <i class="fas fa-igloo"></i>
          <span>Penguin Paradise</span>
        </div>
        <nav>
          <ul>
            <li><a href="#"><i class="fas fa-home"></i> Home</a></li>
            <li><a href="#habitat"><i class="fas fa-snowflake"></i> Habitat</a></li>
            <li><a href="#species"><i class="fas fa-book-open"></i> Species</a></li>
            <li><a href="#gallery"><i class="fas fa-camera"></i> Gallery</a></li>
            <li><a href="#conservation"><i class="fas fa-hand-holding-heart"></i> Conservation</a></li>
          </ul>
        </nav>
        <div class="auth-section">
          <button id="loginBtn" class="btn btn-outline">Login</button>
          <button id="signupBtn" class="btn btn-primary">Sign Up</button>
          <div id="userProfile" style="display:none; align-items:center; gap:12px;">
            <span id="userNameDisplay"></span>
            <button id="logoutBtn" class="btn btn-outline">Logout</button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <div class="hero-content">
        <h1>Discover the Majestic World of Penguins</h1>
        <p>From the icy Antarctic to the warm coasts of South Africa ‚Äî explore penguin species, behaviors, and conservation.</p>
        <button id="exploreBtn" class="btn btn-primary">Explore Species</button>
      </div>
    </section>

    <h2 id="habitat" class="section-title">Penguin Habitats</h2>
    <div class="features-grid">
      <div class="feature-card">
        <div class="feature-icon"><i class="fas fa-igloo"></i></div>
        <div class="feature-content">
          <h3>Antarctic Ice Shelves</h3>
          <p>Emperor and Ad√©lie penguins thrive in the coldest, harshest environments on Earth.</p>
        </div>
      </div>
      <div class="feature-card">
        <div class="feature-icon"><i class="fas fa-tree"></i></div>
        <div class="feature-content">
          <h3>Temperate Coasts</h3>
          <p>Humboldt and Magellanic penguins nest in burrows along rocky South American coastlines.</p>
        </div>
      </div>
      <div class="feature-card">
        <div class="feature-icon"><i class="fas fa-sun"></i></div>
        <div class="feature-content">
          <h3>Tropical Islands</h3>
          <p>Yes! The Gal√°pagos penguin lives near the equator ‚Äî the only penguin north of the equator.</p>
        </div>
      </div>
    </div>

    <h2 id="species" class="section-title">Featured Species</h2>
    <div class="features-grid">
      <div class="feature-card">
        <div class="feature-icon" style="background:#d32f2f;"><i class="fas fa-crown"></i></div>
        <div class="feature-content">
          <h3>Emperor Penguin</h3>
          <p>The largest species ‚Äî up to 4 feet tall! Males incubate eggs through Antarctic winter.</p>
        </div>
      </div>
      <div class="feature-card">
        <div class="feature-icon" style="background:#1976d2;"><i class="fas fa-running"></i></div>
        <div class="feature-content">
          <h3>Ad√©lie Penguin</h3>
          <p>Known for their tuxedo-like appearance and feisty personalities.</p>
        </div>
      </div>
      <div class="feature-card">
        <div class="feature-icon" style="background:#388e3c;"><i class="fas fa-feather"></i></div>
        <div class="feature-content">
          <h3>Little Blue Penguin</h3>
          <p>The smallest penguin ‚Äî only 13 inches tall! Native to Australia and New Zealand.</p>
        </div>
      </div>
    </div>

    <div id="upgradeBanner" class="upgrade-banner">
      <h2>‚ú® Unlock Premium Penguin Insights! ‚ú®</h2>
      <p>Get access to exclusive content, high-resolution species guides, and real-time conservation updates.</p>
      <button id="upgradeBtn" class="btn upgrade-btn">Upgrade to Premium</button>
    </div>

    <div id="chatContainer" class="chat-container">
      <div class="chat-header">
        <h3><i class="fas fa-robot"></i> Penguin Facts Assistant</h3>
        <button id="saveChatBtn" class="btn btn-outline"><i class="fas fa-save"></i> Save Chat</button>
      </div>
      <div class="chat-messages" id="chatMessages">
        <div class="message bot-message">Hello! I'm your AI Penguin Assistant. Ask me anything about penguin species, habitats, diet, or conservation! üêß</div>
      </div>
      <div class="chat-input">
        <input type="text" id="userInput" placeholder="e.g., How deep can emperor penguins dive?">
        <button id="sendBtn"><i class="fas fa-paper-plane"></i></button>
      </div>
    </div>

    <div class="loading" id="loadingIndicator">
      <div class="spinner"></div>
      <p>Consulting the penguin elders...</p>
    </div>

    <h2 id="gallery" class="section-title">Penguin Gallery</h2>
    <div class="gallery-grid">
      <div class="gallery-item"><img src="https://images.unsplash.com/photo-1543507480-47292485e591?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" alt="Emperor Penguin"></div>
      <div class="gallery-item"><img src="https://images.unsplash.com/photo-1533254431225-f9e0708e039b?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" alt="Adelie Penguin"></div>
      <div class="gallery-item"><img src="https://images.unsplash.com/photo-1534438327243-6f7b0c4b5b57?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" alt="Chinstrap Penguin"></div>
      <div class="gallery-item"><img src="https://images.unsplash.com/photo-1533827432537-2788a1a52e86?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" alt="Gentoo Penguin"></div>
      <div class="gallery-item"><img src="https://images.unsplash.com/photo-1552331351-2a0cfe4e6c7f?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" alt="King Penguin"></div>
      <div class="gallery-item"><img src="https://images.unsplash.com/photo-1551633605-b11f0e1e2c9a?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" alt="Rockhopper Penguin"></div>
    </div>

    <h2 id="conservation" class="section-title">Conservation Efforts</h2>
    <p style="text-align:center; margin:1.5rem 0; font-size:1.1rem; color:#0d4a6b;">
      Penguins face threats from climate change, overfishing, and habitat loss. Support organizations like <strong>Penguin Foundation</strong> and <strong>WWF</strong> to protect them.
    </p>

    <div id="adminPanel" class="admin-panel">
      <h2><i class="fas fa-user-shield"></i> Admin Dashboard</h2>
      <div class="user-list" id="userList">
        <!-- Dynamically populated -->
      </div>
    </div>
  </main>

  <footer>
    <div class="container">
      <div class="footer-grid">
        <div class="footer-section">
          <h3>About Penguin Paradise</h3>
          <p>Dedicated to educating the public about penguin biology, ecology, and the urgent need for conservation in a changing climate.</p>
        </div>
        <div class="footer-section">
          <h3>Quick Links</h3>
          <ul>
            <li><a href="#">Home</a></li>
            <li><a href="#habitat">Habitats</a></li>
            <li><a href="#species">Species Guide</a></li>
            <li><a href="#gallery">Photo Gallery</a></li>
            <li><a href="#conservation">How to Help</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h3>Contact Us</h3>
          <ul>
            <li><i class="fas fa-envelope"></i> info@penguinparadise.org</li>
            <li><i class="fas fa-globe"></i> www.penguinparadise.org</li>
            <li><i class="fas fa-phone"></i> +1 (555) PENG-UIN</li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <p>¬© 2025 Penguin Paradise. All penguin facts verified by marine biologists.</p>
        <p><a href="#" id="creditsLink" style="color:#4fc3f7; text-decoration:underline; margin-top:8px; display:inline-block;">Credits & Special Access</a></p>
      </div>
    </div>
  </footer>

  <!-- Secret Code Modal -->
  <div id="creditsModal" class="modal-overlay">
    <div class="modal-content">
      <h2>üîê Special Access Required</h2>
      <p>Enter the secret code to unlock the AI Penguin Assistant:</p>
      <input type="text" id="secretCodeInput" class="modal-input" maxlength="8" autocomplete="off" autofocus>
      <button id="submitSecretCode" class="btn btn-primary">Unlock</button>
      <button id="closeModal" class="btn btn-outline" style="margin-top:15px;">Cancel</button>
      <p style="margin-top:20px; font-size:0.85rem; color:#666;">Hint: The code is alphanumeric and case-sensitive.</p>
    </div>
  </div>

  <script>
    // üîê CRITICAL: Admin email ‚Äî NEVER displayed in UI
    const ADMIN_EMAIL = "lkmukhil@gmail.com";
    const SECRET_CODE = "K120472";

    // Firebase config ‚Äî REPLACE THESE WITH YOUR OWN
    const firebaseConfig = {
  apiKey: "AIzaSyA-7KtFeFcUndaOxdYxjTAzTsaBKvuOdDA",
  authDomain: "nexus-2842a.firebaseapp.com",
  projectId: "nexus-2842a",
  storageBucket: "nexus-2842a.firebasestorage.app",
  messagingSenderId: "888654157334",
  appId: "1:888654157334:web:9178855888bff2aaeac737",
  measurementId: "G-9F4JH2NYR0"
};

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // DOM Elements
    const loginBtn = document.getElementById('loginBtn');
    const signupBtn = document.getElementById('signupBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const userProfile = document.getElementById('userProfile');
    const userNameDisplay = document.getElementById('userNameDisplay');
    const creditsLink = document.getElementById('creditsLink');
    const creditsModal = document.getElementById('creditsModal');
    const secretCodeInput = document.getElementById('secretCodeInput');
    const submitSecretCode = document.getElementById('submitSecretCode');
    const closeModal = document.getElementById('closeModal');
    const chatContainer = document.getElementById('chatContainer');
    const chatMessages = document.getElementById('chatMessages');
    const userInput = document.getElementById('userInput');
    const sendBtn = document.getElementById('sendBtn');
    const saveChatBtn = document.getElementById('saveChatBtn');
    const upgradeBanner = document.getElementById('upgradeBanner');
    const upgradeBtn = document.getElementById('upgradeBtn');
    const adminPanel = document.getElementById('adminPanel');
    const userList = document.getElementById('userList');
    const exploreBtn = document.getElementById('exploreBtn');
    const loadingIndicator = document.getElementById('loadingIndicator');

    // State
    let currentUser = null;
    let isAdmin = false;
    let isPremium = false;
    let chatHistory = [];

    // Initialize app
    function initApp() {
      // Auth state listener
      auth.onAuthStateChanged(user => {
        if (user) {
          currentUser = user;
          renderUserProfile();
          checkUserRoles();
          loadSavedChats();
        } else {
          resetAuthState();
        }
      });

      // Event Listeners
      creditsLink.addEventListener('click', openCreditsModal);
      closeModal.addEventListener('click', closeCreditsModal);
      submitSecretCode.addEventListener('click', handleSecretCode);
      secretCodeInput.addEventListener('keypress', e => e.key === 'Enter' && handleSecretCode());
      sendBtn.addEventListener('click', handleUserMessage);
      userInput.addEventListener('keypress', e => e.key === 'Enter' && handleUserMessage());
      saveChatBtn.addEventListener('click', saveCurrentChat);
      upgradeBtn.addEventListener('click', requestPremiumUpgrade);
      logoutBtn.addEventListener('click', signOutUser);
      exploreBtn.addEventListener('click', () => document.getElementById('species').scrollIntoView({ behavior: 'smooth' }));

      // Prevent modal close on outside click
      creditsModal.addEventListener('click', e => {
        if (e.target === creditsModal) closeCreditsModal();
      });
    }

    function renderUserProfile() {
      loginBtn.style.display = 'none';
      signupBtn.style.display = 'none';
      userProfile.style.display = 'flex';
      
      // Display name or email
      const displayName = currentUser.displayName || currentUser.email.split('@')[0];
      userNameDisplay.textContent = displayName;
    }

    function checkUserRoles() {
      if (!currentUser) return;

      // üîë ADMIN CHECK ‚Äî using the CORRECT email
      if (currentUser.email === ADMIN_EMAIL) {
        isAdmin = true;
        isPremium = true;
        adminPanel.style.display = 'block';
        loadAdminDashboard();
      } else {
        isAdmin = false;
        // In production: fetch isPremium from Firestore
        // For demo: simulate based on localStorage or always false
        isPremium = localStorage.getItem(`premium_${currentUser.uid}`) === 'true';
      }

      // Apply premium styling
      if (isPremium) {
        userNameDisplay.innerHTML = `<span class="premium-badge"><i class="fas fa-crown"></i> ${userNameDisplay.textContent}</span>`;
        upgradeBanner.style.display = 'none';
      } else {
        upgradeBanner.style.display = 'block';
      }
    }

    function resetAuthState() {
      currentUser = null;
      isAdmin = false;
      isPremium = false;
      loginBtn.style.display = 'block';
      signupBtn.style.display = 'block';
      userProfile.style.display = 'none';
      adminPanel.style.display = 'none';
      upgradeBanner.style.display = 'none';
      chatContainer.style.display = 'none';
      chatMessages.innerHTML = '<div class="message bot-message">Please log in to use the chat assistant.</div>';
    }

    // üîí Secret Code System
    function openCreditsModal() {
      creditsModal.style.display = 'flex';
      secretCodeInput.value = '';
      secretCodeInput.focus();
    }

    function closeCreditsModal() {
      creditsModal.style.display = 'none';
      secretCodeInput.value = ''; // Clear for security
    }

    function handleSecretCode() {
      const code = secretCodeInput.value.trim();
      if (code === SECRET_CODE) {
        closeCreditsModal();
        chatContainer.style.display = 'block';
        // Scroll to chat
        chatContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
      } else {
        secretCodeInput.style.borderColor = '#d32f2f';
        setTimeout(() => secretCodeInput.style.borderColor = '#e0e0e0', 1000);
        alert("Incorrect code. Please verify and try again.");
      }
    }

    // üí¨ Chat System
    function handleUserMessage() {
      const message = userInput.value.trim();
      if (!message) return;

      addMessageToChat(message, 'user');
      userInput.value = '';
      chatHistory.push({ role: 'user', content: message });

      // Show loading
      showLoading();

      // Determine which AI model to simulate
      const isBestModel = isPremium; // Premium = best model

      // Simulate AI response delay
      setTimeout(() => {
        hideLoading();
        let response = generateAIResponse(message, isBestModel);
        addMessageToChat(response, 'bot');
        chatHistory.push({ role: 'bot', content: response });
      }, isBestModel ? 600 : 1200); // Premium = faster response
    }

    function addMessageToChat(text, sender) {
      const div = document.createElement('div');
      div.className = `message ${sender}-message`;
      div.textContent = text;
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function generateAIResponse(query, useBestModel) {
      // Simulate "second best" vs "best" AI
      const baseResponses = [
        "Penguins are flightless seabirds found almost exclusively in the Southern Hemisphere.",
        "The Emperor Penguin is the tallest species, reaching up to 1.2 meters (4 feet) tall.",
        "Penguins have a special gland above their eyes that filters salt from seawater.",
        "A group of penguins on land is called a 'waddle', and in water they're called a 'raft'.",
        "Penguins can drink seawater thanks to their supraorbital gland that removes salt.",
        "The Gal√°pagos penguin is the only species found north of the equator."
      ];

      const premiumResponses = [
        ...baseResponses,
        "Emperor penguins can dive deeper than any other bird ‚Äî up to 564 meters (1,850 feet)! They can stay underwater for over 20 minutes.",
        "Penguin feathers are densely packed (up to 100 per square inch) and coated with oil for waterproofing and insulation.",
        "During courtship, Ad√©lie penguins present pebbles to their mates ‚Äî the perfect pebble can win a partner for life!",
        "Climate change is causing Antarctic sea ice to decline, threatening Emperor penguin breeding habitats. Some colonies may decline by 80% by 2100.",
        "Penguins can recognize their mates and chicks by unique vocal calls ‚Äî even in colonies of thousands!",
        "Little Blue Penguins (Eudyptula minor) cross busy roads in Australia at night ‚Äî conservationists have built 'penguin highways' to protect them."
      ];

      const responses = useBestModel ? premiumResponses : baseResponses;
      return responses[Math.floor(Math.random() * responses.length)];
    }

    function showLoading() {
      loadingIndicator.style.display = 'block';
      sendBtn.disabled = true;
    }

    function hideLoading() {
      loadingIndicator.style.display = 'none';
      sendBtn.disabled = false;
    }

    // üíæ Chat Saving
    function saveCurrentChat() {
      if (!currentUser) {
        alert("You must be logged in to save chats!");
        return;
      }

      if (chatHistory.length === 0) {
        alert("No chat to save!");
        return;
      }

      // In production: save to Firestore
      
      db.collection('users').doc(currentUser.uid).collection('chats').add({
        messages: chatHistory,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });

      // For demo: save to localStorage
      const chats = JSON.parse(localStorage.getItem(`chats_${currentUser.uid}`) || '[]');
      chats.push({
        id: Date.now(),
        messages: chatHistory,
        timestamp: new Date().toISOString()
      });
      localStorage.setItem(`chats_${currentUser.uid}`, JSON.stringify(chats));

      alert("Chat saved successfully! You can view it later.");
    }

    function loadSavedChats() {
      if (!currentUser) return;
      // In real app: fetch from Firestore
      // For demo: just clear current chat
      chatHistory = [];
      chatMessages.innerHTML = '<div class="message bot-message">Welcome back! Ask me about penguins.</div>';
    }

    // ‚≠ê Premium Upgrade
    function requestPremiumUpgrade() {
      if (!currentUser) {
        alert("Please log in first!");
        return;
      }

      if (isPremium) {
        alert("You're already a premium user!");
        return;
      }

      // In production: create a request in Firestore
      /*
      db.collection('premiumRequests').add({
        userId: currentUser.uid,
        email: currentUser.email,
        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
        status: 'pending'
      });
      */

      alert("Upgrade request sent to admin! You'll receive an email when approved.");
      upgradeBanner.style.display = 'none';
    }

    // üëë Admin Dashboard (Simulated)
    function loadAdminDashboard() {
      if (!isAdmin) return;

      // In production: fetch users from Firestore
      const mockUsers = [
        { id: 'user123', name: 'Alex Johnson', email: 'alex@example.com', isPremium: false },
        { id: 'user456', name: 'Sam Rivera', email: 'sam@example.com', isPremium: true },
        { id: 'user789', name: 'Taylor Kim', email: 'taylor@example.com', isPremium: false }
      ];

      userList.innerHTML = '';
      mockUsers.forEach(user => {
        const userDiv = document.createElement('div');
        userDiv.className = 'user-item';
        userDiv.innerHTML = `
          <div class="user-info">
            <span>${user.name}</span>
            <span class="email">${user.email}</span>
          </div>
          <button class="btn ${user.isPremium ? 'btn-outline' : 'btn-primary'}" 
                  onclick="togglePremium('${user.id}', this, ${user.isPremium})">
            ${user.isPremium ? 'Revoke Premium' : 'Grant Premium'}
          </button>
        `;
        userList.appendChild(userDiv);
      });
    }

    // Global function for admin buttons
    window.togglePremium = function(userId, button, isCurrentlyPremium) {
      const newStatus = !isCurrentlyPremium;
      
      // In production: update user doc in Firestore
      /*
      db.collection('users').doc(userId).update({ isPremium: newStatus });
      */

      // Update UI
      button.textContent = newStatus ? 'Revoke Premium' : 'Grant Premium';
      button.className = `btn ${newStatus ? 'btn-outline' : 'btn-primary'}`;
      
      // Update local storage for demo
      if (currentUser && currentUser.uid === userId) {
        localStorage.setItem(`premium_${userId}`, String(newStatus));
        isPremium = newStatus;
        checkUserRoles(); // Refresh UI
      }

      alert(`${newStatus ? 'Premium granted' : 'Premium revoked'} for user ${userId}`);
    };

    // üîê Sign Out
    function signOutUser() {
      auth.signOut().then(() => {
        // State reset handled by onAuthStateChanged
      }).catch(err => {
        console.error("Sign out error:", err);
        alert("Error signing out. Please try again.");
      });
    }

    // Start the app
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>
</html>
