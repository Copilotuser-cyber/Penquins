<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Penguin Paradise | Learn About Penguins</title>
  <meta name="description" content="Discover penguin species, habitats, behaviors, and conservation. A comprehensive resource for penguin lovers.">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <style>
    :root {
      --primary: #0d4a6b;
      --secondary: #2e7d32;
      --accent: #d32f2f;
      --bg: #e3f2fd;
      --card: #ffffff;
      --text: #1a237e;
      --footer-bg: #0a2e4d;
      --modal-bg: rgba(0,0,0,0.85);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', system-ui, sans-serif; }
    body { background: var(--bg); color: var(--text); line-height: 1.6; }
    .container { width: 90%; max-width: 1200px; margin: 0 auto; padding: 0 15px; }

    /* Auth Modals */
    .auth-modal {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: var(--modal-bg);
      z-index: 2000;
      justify-content: center;
      align-items: center;
    }
    .auth-content {
      background: white; padding: 2.5rem; border-radius: 16px; width: 90%; max-width: 450px;
    }
    .auth-content h2 { text-align: center; margin-bottom: 1.5rem; color: var(--primary); }
    .form-group { margin-bottom: 1.2rem; }
    .form-group label { display: block; margin-bottom: 6px; font-weight: 600; }
    .form-control {
      width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem;
    }
    .btn { padding: 10px 20px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; }
    .btn-block { width: 100%; margin-top: 10px; }
    .btn-primary { background: #4fc3f7; color: var(--footer-bg); }
    .btn-outline { background: transparent; border: 1px solid white; color: white; }
    .switch-form { text-align: center; margin-top: 15px; color: #666; }
    .switch-form a { color: var(--secondary); text-decoration: none; font-weight: 600; }

    /* Main Styles */
    header { background: var(--footer-bg); color: white; padding: 1rem 0; }
    .header-content { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
    .logo { font-size: 1.8rem; display: flex; align-items: center; gap: 10px; }
    .auth-buttons { display: flex; gap: 10px; }
    main { padding: 2rem 0; }
    .hero { 
      background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://images.unsplash.com/photo-1543507480-47292485e591?auto=format&fit=crop&w=1200&q=80');
      height: 400px; border-radius: 16px; margin-bottom: 2.5rem; display: flex; align-items: center; justify-content: center; color: white; 
    }
    .hero-content { text-align: center; max-width: 800px; }
    .hero h1 { font-size: 2.8rem; margin-bottom: 1rem; }
    .hero p { font-size: 1.2rem; }

    .section { margin: 3rem 0; }
    .section-title { text-align: center; margin-bottom: 2rem; color: var(--primary); font-size: 2rem; }

    .species-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
    }
    .species-card {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .species-img {
      height: 200px;
      background-size: cover;
      background-position: center;
    }
    .species-content { padding: 1.5rem; }
    .species-content h3 { margin-bottom: 0.8rem; color: var(--primary); }

    .habitat-facts {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-top: 1.5rem;
    }
    .fact-card {
      background: white;
      padding: 1.5rem;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .fact-card h4 { color: var(--secondary); margin-bottom: 0.5rem; }

    /* Whisperer */
    .whisperer-container {
      display: none;
      background: white;
      border-radius: 12px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.15);
      margin: 2rem 0;
    }
    .whisperer-header {
      background: var(--primary);
      color: white;
      padding: 1rem 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .whisperer-messages {
      height: 350px;
      padding: 1.5rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .message {
      max-width: 80%;
      padding: 12px 16px;
      border-radius: 18px;
      line-height: 1.5;
    }
    .user-message {
      background: #e3f2fd;
      align-self: flex-end;
    }
    .bot-message {
      background: #e8f5e9;
      align-self: flex-start;
    }
    .whisperer-input {
      display: flex;
      padding: 0 1.5rem 1.5rem;
      gap: 10px;
    }
    .whisperer-input input {
      flex: 1;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 30px;
    }
    .whisperer-input button {
      background: var(--secondary);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 30px;
    }

    /* Admin Panel */
    .admin-panel {
      display: none;
      background: #f0f9ff;
      border: 2px dashed #4fc3f7;
      border-radius: 12px;
      padding: 2rem;
      margin: 2rem 0;
    }
    .admin-panel h2 {
      text-align: center;
      margin-bottom: 1.5rem;
      color: var(--primary);
    }
    .users-list, .chats-list {
      margin-top: 1.5rem;
    }
    .user-item, .chat-item {
      padding: 12px;
      border-bottom: 1px solid #eee;
    }

    /* Footer */
    footer {
      background: var(--footer-bg);
      color: #cfd8dc;
      padding: 2.5rem 0 1.5rem;
      margin-top: 3rem;
    }
    .footer-bottom {
      text-align: center;
      padding-top: 1.5rem;
      border-top: 1px solid #37474f;
    }

    /* Secret Code Modal */
    .credits-modal {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: var(--modal-bg);
      z-index: 2000;
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: white; padding: 2.5rem; border-radius: 16px; width: 90%; max-width: 500px; text-align: center;
    }
    .modal-input {
      width: 100%; padding: 14px; margin: 20px 0; border: 1px solid #ddd; border-radius: 8px; font-size: 1.1rem; text-align: center;
    }

    /* Loading */
    .loading {
      text-align: center;
      padding: 2rem;
      display: none;
    }
    .spinner {
      border: 4px solid rgba(0,0,0,0.1);
      border-left: 4px solid var(--secondary);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <!-- Auth Modals -->
  <div id="loginModal" class="auth-modal">
    <div class="auth-content">
      <h2>Login to Penguin Paradise</h2>
      <div class="form-group">
        <label for="loginEmail">Email</label>
        <input type="email" id="loginEmail" class="form-control" placeholder="you@example.com">
      </div>
      <div class="form-group">
        <label for="loginPassword">Password</label>
        <input type="password" id="loginPassword" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
      </div>
      <button id="doLogin" class="btn btn-primary btn-block">Login</button>
      <div class="switch-form">
        Don't have an account? <a href="#" id="showSignup">Sign Up</a>
      </div>
    </div>
  </div>

  <div id="signupModal" class="auth-modal">
    <div class="auth-content">
      <h2>Create an Account</h2>
      <div class="form-group">
        <label for="signupEmail">Email</label>
        <input type="email" id="signupEmail" class="form-control" placeholder="you@example.com">
      </div>
      <div class="form-group">
        <label for="signupPassword">Password</label>
        <input type="password" id="signupPassword" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
      </div>
      <button id="doSignup" class="btn btn-primary btn-block">Sign Up</button>
      <div class="switch-form">
        Already have an account? <a href="#" id="showLogin">Login</a>
      </div>
    </div>
  </div>

  <!-- Secret Code Modal -->
  <div id="creditsModal" class="credits-modal">
    <div class="modal-content">
      <h2>Enter Secret Code</h2>
      <p>Access the Penguin Whisperer by entering the secret code:</p>
      <input type="text" id="secretCode" class="modal-input" placeholder="K120472" maxlength="8" autocomplete="off">
      <button id="submitCode" class="btn btn-primary">Unlock</button>
      <button id="closeModal" class="btn btn-outline" style="margin-top:15px; background:transparent; border-color:white;">Close</button>
    </div>
  </div>

  <!-- Main Site -->
  <header>
    <div class="container">
      <div class="header-content">
        <div class="logo"><i class="fas fa-igloo"></i> Penguin Paradise</div>
        <div class="auth-buttons">
          <button id="loginBtn" class="btn btn-outline">Login</button>
          <button id="signupBtn" class="btn btn-primary">Sign Up</button>
          <div id="userProfile" style="display:none; align-items:center; gap:10px;">
            <span id="userName"></span>
            <button id="logoutBtn" class="btn btn-outline">Logout</button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="hero">
      <div class="hero-content">
        <h1>Welcome to Penguin Paradise</h1>
        <p>Your trusted source for penguin facts, species information, and conservation efforts.</p>
      </div>
    </div>

    <section class="section">
      <h2 class="section-title">Penguin Species</h2>
      <div class="species-grid">
        <div class="species-card">
          <div class="species-img" style="background-image: url('https://images.unsplash.com/photo-1543507480-47292485e591?auto=format&fit=crop&w=600&q=80');"></div>
          <div class="species-content">
            <h3>Emperor Penguin</h3>
            <p>The largest penguin species, standing up to 1.2 meters tall. They breed during the Antarctic winter.</p>
          </div>
        </div>
        <div class="species-card">
          <div class="species-img" style="background-image: url('https://images.unsplash.com/photo-1533254431225-f9e0708e039b?auto=format&fit=crop&w=600&q=80');"></div>
          <div class="species-content">
            <h3>Ad√©lie Penguin</h3>
            <p>Known for their tuxedo-like appearance and feisty behavior. They build nests from stones.</p>
          </div>
        </div>
        <div class="species-card">
          <div class="species-img" style="background-image: url('https://images.unsplash.com/photo-1551633605-b11f0e1e2c9a?auto=format&fit=crop&w=600&q=80');"></div>
          <div class="species-content">
            <h3>Rockhopper Penguin</h3>
            <p>Recognizable by their spiky yellow eyebrows and red eyes. They hop over rocky terrain.</p>
          </div>
        </div>
      </div>
    </section>

    <section class="section">
      <h2 class="section-title">Penguin Facts</h2>
      <div class="habitat-facts">
        <div class="fact-card">
          <h4>Habitat Range</h4>
          <p>Penguins live in the Southern Hemisphere‚Äîfrom Antarctica to the Gal√°pagos Islands near the equator.</p>
        </div>
        <div class="fact-card">
          <h4>Diet</h4>
          <p>They eat krill, fish, and squid. A single penguin can eat up to 2 kg of food per day.</p>
        </div>
        <div class="fact-card">
          <h4>Parenting</h4>
          <p>Emperor penguin fathers balance eggs on their feet for 65 days through Antarctic winter.</p>
        </div>
        <div class="fact-card">
          <h4>Conservation</h4>
          <p>10 of 18 penguin species are threatened by climate change, overfishing, and habitat loss.</p>
        </div>
      </div>
    </section>

    <section class="section">
      <h2 class="section-title">Penguin Behavior</h2>
      <p>Penguins are highly social birds that live in large colonies called rookeries. They communicate through vocal calls and body movements. Each penguin has a unique call that helps them find their mate and chick in crowded colonies of thousands.</p>
      <p>They spend up to 75% of their lives in the water, where they are agile swimmers, using their wings as flippers to "fly" underwater at speeds up to 22 mph.</p>
    </section>

    <!-- Hidden Whisperer (Secret Chat) -->
    <div id="whispererContainer" class="whisperer-container">
      <div class="whisperer-header">
        <h3><i class="fas fa-feather"></i> Penguin Whisperer</h3>
        <button id="saveChatBtn" class="btn btn-outline">Save Conversation</button>
      </div>
      <div class="whisperer-messages" id="whispererMessages">
        <div class="message bot-message">Hello! I'm the Penguin Whisperer. Ask me anything about penguins! üêß</div>
      </div>
      <div class="whisperer-input">
        <input type="text" id="userInput" placeholder="e.g., How do penguins stay warm in Antarctica?">
        <button id="sendBtn">Send</button>
      </div>
    </div>

    <div class="loading" id="loadingIndicator">
      <div class="spinner"></div>
      <p>Listening to the penguins...</p>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="admin-panel">
      <h2>Conservation Dashboard</h2>
      
      <div class="users-list">
        <h3>Registered Users</h3>
        <div id="usersList">Loading users...</div>
      </div>
      
      <div class="chats-list">
        <h3>All Conversations</h3>
        <div id="allChats">Loading chats...</div>
      </div>
    </div>
  </main>

  <footer>
    <div class="container">
      <div class="footer-bottom">
        <p>¬© 2025 Penguin Paradise</p>
        <p><a href="#" id="creditsLink" style="color:#4fc3f7;">Credits</a></p>
      </div>
    </div>
  </footer>

  <script>
    // üîë Admin email (never shown in UI)
    const ADMIN_EMAIL = "lkmukhil@gmail.com";
    const SECRET_CODE = "K120472";

    // Firebase config - REPLACE WITH YOUR OWN
    const firebaseConfig = {
  apiKey: "AIzaSyA-7KtFeFcUndaOxdYxjTAzTsaBKvuOdDA",
  authDomain: "nexus-2842a.firebaseapp.com",
  projectId: "nexus-2842a",
  storageBucket: "nexus-2842a.firebasestorage.app",
  messagingSenderId: "888654157334",
  appId: "1:888654157334:web:9178855888bff2aaeac737",
  measurementId: "G-9F4JH2NYR0"
};

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // DOM Elements
    const loginBtn = document.getElementById('loginBtn');
    const signupBtn = document.getElementById('signupBtn');
    const loginModal = document.getElementById('loginModal');
    const signupModal = document.getElementById('signupModal');
    const doLogin = document.getElementById('doLogin');
    const doSignup = document.getElementById('doSignup');
    const showSignup = document.getElementById('showSignup');
    const showLogin = document.getElementById('showLogin');
    const logoutBtn = document.getElementById('logoutBtn');
    const userProfile = document.getElementById('userProfile');
    const userName = document.getElementById('userName');
    const creditsLink = document.getElementById('creditsLink');
    const creditsModal = document.getElementById('creditsModal');
    const secretCode = document.getElementById('secretCode');
    const submitCode = document.getElementById('submitCode');
    const closeModal = document.getElementById('closeModal');
    const whispererContainer = document.getElementById('whispererContainer');
    const whispererMessages = document.getElementById('whispererMessages');
    const userInput = document.getElementById('userInput');
    const sendBtn = document.getElementById('sendBtn');
    const saveChatBtn = document.getElementById('saveChatBtn');
    const adminPanel = document.getElementById('adminPanel');
    const usersList = document.getElementById('usersList');
    const allChats = document.getElementById('allChats');
    const loadingIndicator = document.getElementById('loadingIndicator');

    // State
    let currentUser = null;
    let isAdmin = false;

    // Initialize
    function init() {
      auth.onAuthStateChanged(user => {
        if (user) {
          currentUser = user;
          loginBtn.style.display = 'none';
          signupBtn.style.display = 'none';
          userProfile.style.display = 'flex';
          userName.textContent = user.email.split('@')[0];
          
          if (user.email === ADMIN_EMAIL) {
            isAdmin = true;
            adminPanel.style.display = 'block';
            loadAdminData();
          } else {
            isAdmin = false;
            adminPanel.style.display = 'none';
          }
        } else {
          currentUser = null;
          isAdmin = false;
          loginBtn.style.display = 'block';
          signupBtn.style.display = 'block';
          userProfile.style.display = 'none';
          adminPanel.style.display = 'none';
          whispererContainer.style.display = 'none';
        }
      });

      // Event Listeners
      loginBtn.addEventListener('click', () => loginModal.style.display = 'flex');
      signupBtn.addEventListener('click', () => signupModal.style.display = 'flex');
      showSignup.addEventListener('click', () => { loginModal.style.display = 'none'; signupModal.style.display = 'flex'; });
      showLogin.addEventListener('click', () => { signupModal.style.display = 'none'; loginModal.style.display = 'flex'; });
      doLogin.addEventListener('click', handleLogin);
      doSignup.addEventListener('click', handleSignup);
      logoutBtn.addEventListener('click', () => auth.signOut());
      creditsLink.addEventListener('click', () => creditsModal.style.display = 'flex');
      closeModal.addEventListener('click', () => { creditsModal.style.display = 'none'; secretCode.value = ''; });
      submitCode.addEventListener('click', handleSecretCode);
      sendBtn.addEventListener('click', sendMessage);
      userInput.addEventListener('keypress', e => e.key === 'Enter' && sendMessage());
      saveChatBtn.addEventListener('click', saveChat);

      [loginModal, signupModal, creditsModal].forEach(modal => {
        modal.addEventListener('click', e => {
          if (e.target === modal) {
            modal.style.display = 'none';
            if (modal === creditsModal) secretCode.value = '';
          }
        });
      });
    }

    // Auth Functions
    async function handleLogin() {
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      if (!email || !password) {
        alert("Please fill in all fields");
        return;
      }

      try {
        await auth.signInWithEmailAndPassword(email, password);
        loginModal.style.display = 'none';
        document.getElementById('loginEmail').value = '';
        document.getElementById('loginPassword').value = '';
      } catch (err) {
        alert("Login failed: " + err.message);
      }
    }

    async function handleSignup() {
      const email = document.getElementById('signupEmail').value;
      const password = document.getElementById('signupPassword').value;
      if (!email || !password || password.length < 6) {
        alert("Password must be at least 6 characters");
        return;
      }

      try {
        await auth.createUserWithEmailAndPassword(email, password);
        await db.collection('users').doc(auth.currentUser.uid).set({
          email: email,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        signupModal.style.display = 'none';
        document.getElementById('signupEmail').value = '';
        document.getElementById('signupPassword').value = '';
      } catch (err) {
        alert("Signup failed: " + err.message);
      }
    }

    // Secret Code
    function handleSecretCode() {
      if (secretCode.value.trim() === SECRET_CODE) {
        creditsModal.style.display = 'none';
        secretCode.value = '';
        whispererContainer.style.display = 'block';
        whispererContainer.scrollIntoView({ behavior: 'smooth' });
      } else {
        alert("Incorrect code. Please try again.");
      }
    }

    // Whisperer with SECURE Vercel Function
    async function sendMessage() {
      const message = userInput.value.trim();
      if (!message) return;

      addMessage(message, 'user');
      userInput.value = '';
      showLoading();

      try {
        // Call OUR secure Vercel function (not Hugging Face directly)
        const response = await fetch('/api/whisperer', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prompt: message })
        });

        if (!response.ok) {
          throw new Error('Failed to reach Whisperer');
        }

        const data = await response.json();
        const whispererResponse = data.response || "The penguins are being quiet...";
        
        addMessage(whispererResponse, 'bot');
        
        // Save to Firestore
        if (currentUser) {
          await db.collection('users').doc(currentUser.uid).collection('chats').add({
            messages: [
              { text: message, sender: 'user', timestamp: firebase.firestore.FieldValue.serverTimestamp() },
              { text: whispererResponse, sender: 'whisperer', timestamp: firebase.firestore.FieldValue.serverTimestamp() }
            ],
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });
        }
      } catch (err) {
        console.error("Whisperer error:", err);
        addMessage("The penguins are being quiet right now. Try again later.", 'bot');
      } finally {
        hideLoading();
      }
    }

    function addMessage(text, sender) {
      const div = document.createElement('div');
      div.className = `message ${sender}-message`;
      div.textContent = text;
      whispererMessages.appendChild(div);
      whispererMessages.scrollTop = whispererMessages.scrollHeight;
    }

    function showLoading() {
      loadingIndicator.style.display = 'block';
      sendBtn.disabled = true;
    }

    function hideLoading() {
      loadingIndicator.style.display = 'none';
      sendBtn.disabled = false;
    }

    async function saveChat() {
      if (!currentUser) {
        alert("Please log in to save conversations!");
        return;
      }
      alert("Conversation saved to your profile!");
    }

    // Admin Functions
    async function loadAdminData() {
      if (!isAdmin) return;

      try {
        const usersSnapshot = await db.collection('users').get();
        let usersHtml = '';
        usersSnapshot.forEach(doc => {
          const data = doc.data();
          usersHtml += `<div class="user-item">${data.email} <span style="color:#666; font-size:0.9rem;">(joined ${data.createdAt?.toDate()?.toLocaleDateString() || 'recently'})</span></div>`;
        });
        usersList.innerHTML = usersHtml || "No users registered yet.";

        const allChatsSnapshot = await db.collection('users').get();
        let chatsHtml = '';
        for (const userDoc of allChatsSnapshot.docs) {
          const userChats = await db.collection('users').doc(userDoc.id).collection('chats').get();
          if (!userChats.empty) {
            chatsHtml += `<div class="chat-item"><strong>${userDoc.data().email}</strong>:<br>`;
            userChats.forEach(chatDoc => {
              const messages = chatDoc.data().messages || [];
              messages.forEach(msg => {
                chatsHtml += `<div style="margin-left:15px; margin-top:5px; color:${msg.sender === 'user' ? '#0d4a6b' : '#2e7d32'};">${msg.sender === 'user' ? '‚Üí ' : '‚Üê '} ${msg.text}</div>`;
              });
            });
            chatsHtml += '</div>';
          }
        }
        allChats.innerHTML = chatsHtml || "No conversations yet.";
      } catch (err) {
        console.error("Admin load error:", err);
        usersList.innerHTML = "Error loading data.";
        allChats.innerHTML = "Error loading chats.";
      }
    }

    setInterval(() => {
      if (isAdmin) {
        loadAdminData();
      }
    }, 30000);

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
